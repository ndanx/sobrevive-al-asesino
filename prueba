local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local pGui = player:WaitForChild("PlayerGui")

-- 1. LIMPIEZA
if pGui:FindFirstChild("MasterHub_Final") then pGui.MasterHub_Final:Destroy() end

-- 2. HUB PRINCIPAL
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MasterHub_Final"
screenGui.ResetOnSpawn = false
screenGui.Parent = pGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 220, 0, 280) -- Un poco más ancho para los switches
mainFrame.Position = UDim2.new(0.5, -110, 0.4, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 45, 35) -- Color verde oscuro como tus fotos
mainFrame.Active = true
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)

local layout = Instance.new("UIListLayout", mainFrame)
layout.Padding = UDim.new(0, 10)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Center

-- 3. VARIABLES DE ESTADO
local states = { killer = false, survivor = false, speed = false, infJump = false, noclip = false }

-- 4. FUNCIÓN PARA CREAR FILAS CON SWITCH
local function createToggleRow(labelName)
	local row = Instance.new("Frame")
	row.Size = UDim2.new(0.9, 0, 0, 40)
	row.BackgroundTransparency = 1
	row.Parent = mainFrame
	
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(0.6, 0, 1, 0)
	label.Text = labelName
	label.TextColor3 = Color3.new(1, 1, 1)
	label.Font = Enum.Font.Gotham
	label.TextSize = 14
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.BackgroundTransparency = 1
	label.Parent = row
	
	-- Fondo del Switch
	local switchBg = Instance.new("TextButton")
	switchBg.Size = UDim2.new(0, 45, 0, 22)
	switchBg.Position = UDim2.new(1, -45, 0.5, -11)
	switchBg.BackgroundColor3 = Color3.fromRGB(60, 70, 60) -- Gris apagado
	switchBg.Text = ""
	switchBg.AutoButtonColor = false
	switchBg.Parent = row
	Instance.new("UICorner", switchBg).CornerRadius = UDim.new(1, 0)
	
	-- Círculo del Switch
	local circle = Instance.new("Frame")
	circle.Size = UDim2.new(0, 18, 0, 18)
	circle.Position = UDim2.new(0, 2, 0.5, -9)
	circle.BackgroundColor3 = Color3.new(1, 1, 1)
	circle.Parent = switchBg
	Instance.new("UICorner", circle).CornerRadius = UDim.new(1, 0)
	

	return switchBg, circle
end

-- Configuración de cada función
local function setupToggle(name, displayName, callback)
	local bg, circ, chk = createToggleRow(displayName)
	
	bg.MouseButton1Click:Connect(function()
		states[name] = not states[name]
		local active = states[name]
		
		-- Animación visual
		bg.BackgroundColor3 = active and Color3.fromRGB(255, 50, 50) or Color3.fromRGB(60, 70, 60)
		circ:TweenPosition(active and UDim2.new(1, -20, 0.5, -9) or UDim2.new(0, 2, 0.5, -9), "Out", "Quad", 0.15, true)
		chk.Visible = active
		
		if callback then callback(active) end
	end)
end

-- 5. ASIGNACIÓN DE FUNCIONES
setupToggle("killer", "Esp Killer")
setupToggle("survivor", "Esp Survivor")
setupToggle("speed", "Speed")
setupToggle("infJump", "Infinite Jump")
setupToggle("noclip", "Noclip")

-- 6. BUCLE DE FUNCIONAMIENTO (ESP, SPEED, ETC)
RunService.Stepped:Connect(function()
	-- Speed
	if player.Character and player.Character:FindFirstChild("Humanoid") then
		player.Character.Humanoid.WalkSpeed = states.speed and 25 or 16
	end
	
	-- Noclip
	if states.noclip and player.Character then
		for _, v in pairs(player.Character:GetDescendants()) do
			if v:IsA("BasePart") then v.CanCollide = false end
		end
	end

	-- ESP
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= player and p.Character and p.Team then
			local old = p.Character:FindFirstChild("ESPMark")
			local color = nil
			if states.killer and p.Team.Name == "Killer" then color = Color3.new(1,0,0)
			elseif states.survivor and p.Team.Name == "Survivor" then color = Color3.new(0,1,1) end
			
			if color then
				if not old then
					local h = Instance.new("Highlight", p.Character)
					h.Name = "ESPMark"
					h.FillColor = color
				else old.FillColor = color end
			elseif old then old:Destroy() end
		end
	end
end)

-- Infinite Jump
UserInputService.JumpRequest:Connect(function()
	if states.infJump and player.Character and player.Character:FindFirstChild("Humanoid") then
		player.Character.Humanoid:ChangeState("Jumping")
	end
end)

-- 7. MOVIMIENTO (DRAG)
local dragging, dragStart, startPos
mainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true dragStart = input.Position startPos = mainFrame.Position
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = input.Position - dragStart
		mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)
UserInputService.InputEnded:Connect(function(input) dragging = false end)
