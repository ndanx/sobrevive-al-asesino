local Players = game:GetService("Players")
local Teams = game:GetService("Teams")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local pGui = player:WaitForChild("PlayerGui")

-- 1. LIMPIEZA
if pGui:FindFirstChild("MasterHub_Final") then
	pGui.MasterHub_Final:Destroy()
end

-- 2. CREACIÓN DEL HUB (Inmortal)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MasterHub_Final"
screenGui.ResetOnSpawn = false  
screenGui.IgnoreGuiInset = true
screenGui.Parent = pGui

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 180, 0, 200) -- Aumentamos altura para 3 botones
mainFrame.Position = UDim2.new(0.5, -90, 0.4, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
mainFrame.BackgroundTransparency = 0.2
mainFrame.Active = true
mainFrame.Parent = screenGui

Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 15)

local layout = Instance.new("UIListLayout")
layout.Parent = mainFrame
layout.Padding = UDim.new(0, 10)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Center
layout.SortOrder = Enum.SortOrder.LayoutOrder

-- 3. FUNCIÓN PARA CREAR BOTONES
local function createButton(name, text, color, order)
	local btn = Instance.new("TextButton")
	btn.Name = name
	btn.LayoutOrder = order
	btn.Size = UDim2.new(0.85, 0, 0, 35)
	btn.BackgroundColor3 = color
	btn.Text = text
	btn.Font = Enum.Font.GothamBold
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.TextSize = 13
	btn.Parent = mainFrame
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	return btn
end

local killerBtn = createButton("KillerBtn", "Esp Killer", Color3.fromRGB(200, 50, 50), 1)
local survivorBtn = createButton("SurvivorBtn", "Esp Survivor", Color3.fromRGB(50, 150, 200), 2)
local speedBtn = createButton("SpeedBtn", "Speed", Color3.fromRGB(150, 150, 150), 3)

-- 4. MOVIMIENTO (DRAG)
local dragging, dragStart, startPos
mainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = mainFrame.Position
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = input.Position - dragStart
		mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)

UserInputService.InputEnded:Connect(function(input)
	dragging = false
end)

-- 5. LÓGICA ESP Y SPEED
local killerEsp = false
local survivorEsp = false
local speedActive = false
local NORMAL_SPEED = 16
local BOOST_SPEED = 16 * 1.2 -- 20% más

local function updateFunctions()
	-- Lógica ESP
	for _, p in pairs(Players:GetPlayers()) do
		if p == player then continue end
		local char = p.Character
		if char then
			local old = char:FindFirstChild("ESPMark")
			local color = nil
			if p.Team then
				if killerEsp and p.Team.Name == "Killer" then
					color = Color3.fromRGB(255, 0, 0)
				elseif survivorEsp and p.Team.Name == "Survivor" then
					color = Color3.fromRGB(0, 255, 255)
				end
			end
			if color then
				if not old then
					local h = Instance.new("Highlight")
					h.Name = "ESPMark"
					h.FillColor = color
					h.OutlineColor = Color3.new(1, 1, 1)
					h.FillTransparency = 0.5
					h.Parent = char
				else
					old.FillColor = color
				end
			elseif old then
				old:Destroy()
			end
		end
	end

	-- Lógica Speed (Se aplica cada frame por si el juego intenta resetearla)
	local character = player.Character
	if character and character:FindFirstChild("Humanoid") then
		if speedActive then
			character.Humanoid.WalkSpeed = BOOST_SPEED
		else
			character.Humanoid.WalkSpeed = NORMAL_SPEED
		end
	end
end

-- EVENTOS DE BOTONES
killerBtn.MouseButton1Click:Connect(function()
	killerEsp = not killerEsp
	killerBtn.BackgroundColor3 = killerEsp and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
	killerBtn.Text = killerEsp and "KILLER: ON" or "Esp Killer"
end)

survivorBtn.MouseButton1Click:Connect(function()
	survivorEsp = not survivorEsp
	survivorBtn.BackgroundColor3 = survivorEsp and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(50, 150, 200)
	survivorBtn.Text = survivorEsp and "SURVIVOR: ON" or "Esp Survivor"
end)

speedBtn.MouseButton1Click:Connect(function()
	speedActive = not speedActive
	speedBtn.BackgroundColor3 = speedActive and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(150, 150, 150)
	speedBtn.Text = speedActive and "SPEED: ON" or "Speed"
end)

RunService.RenderStepped:Connect(updateFunctions)
