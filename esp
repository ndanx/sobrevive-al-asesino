local UserInputService = game:GetService("UserInputService")
local Teams = game:GetService("Teams")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local screenGui = script.Parent
local mainFrame = screenGui:WaitForChild("Frame")
local espButton = mainFrame:WaitForChild("ESPButton")

-- CONFIGURACIÓN DE DISEÑO (UI)
mainFrame.Size = UDim2.new(0, 200, 0, 120)
mainFrame.Position = UDim2.new(0.5, -100, 0.5, -60)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
mainFrame.BackgroundTransparency = 0.2 -- Efecto opacado
mainFrame.BorderSizePixel = 0

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 15)
corner.Parent = mainFrame

espButton.Size = UDim2.new(0.8, 0, 0, 40)
espButton.Position = UDim2.new(0.1, 0, 0.4, 0)
espButton.Text = "Esp Killer"
espButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100) -- Rojo inicial
espButton.TextColor3 = Color3.new(1, 1, 1)
espButton.Font = Enum.Font.GothamBold
espButton.TextSize = 14

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 8)
btnCorner.Parent = espButton

--- 1. FUNCIÓN PARA MOVER EL HUB (PC y Celular)
local dragging, dragInput, dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

mainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = mainFrame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)

mainFrame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

RunService.RenderStepped:Connect(function()
	if dragging and dragInput then update(dragInput) end
end)

--- 2. LÓGICA DEL ESP KILLER
local espActive = false
local highlights = {}

local function createESP(targetPlayer)
	if targetPlayer.Character and not targetPlayer.Character:FindFirstChild("KillerESP") then
		local highlight = Instance.new("BoxHandleAdornment")
		highlight.Name = "KillerESP"
		highlight.Size = targetPlayer.Character:GetExtentsSize() + Vector3.new(0.1, 0.1, 0.1)
		highlight.AlwaysOnTop = true
		highlight.ZIndex = 5
		highlight.Transparency = 0.5
		highlight.Color3 = Color3.fromRGB(255, 0, 0) -- Rojo transparente
		highlight.Adornee = targetPlayer.Character
		highlight.Parent = targetPlayer.Character
		table.insert(highlights, highlight)
	end
end

local function clearESP()
	for _, v in pairs(workspace:GetDescendants()) do
		if v.Name == "KillerESP" then v:Destroy() end
	end
	highlights = {}
end

espButton.MouseButton1Click:Connect(function()
	espActive = not espActive
	
	if espActive then
		espButton.BackgroundColor3 = Color3.fromRGB(100, 255, 100) -- Verde
		-- Buscar al Killer
		for _, p in pairs(Players:GetPlayers()) do
			if p.Team == Teams:FindFirstChild("Killer") then
				createESP(p)
			end
		end
	else
		espButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100) -- Rojo
		clearESP()
	end
end)
