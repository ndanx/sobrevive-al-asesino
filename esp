local Players = game:GetService("Players")
local Teams = game:GetService("Teams")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local pGui = player:WaitForChild("PlayerGui")

-- 1. CREACIÓN DEL HUB MODERNO
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ModernKillerHub"
screenGui.ResetOnSpawn = false
screenGui.Parent = pGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 180, 0, 100)
mainFrame.Position = UDim2.new(0.5, -90, 0.4, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 15)
corner.Parent = mainFrame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "HUB"
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(50, 50, 50)
title.TextSize = 14
title.Parent = mainFrame

local espButton = Instance.new("TextButton")
espButton.Size = UDim2.new(0.8, 0, 0, 40)
espButton.Position = UDim2.new(0.1, 0, 0.45, 0)
espButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80) -- Rojo inicial
espButton.Text = "Esp Killer"
espButton.Font = Enum.Font.GothamBold
espButton.TextColor3 = Color3.new(1, 1, 1)
espButton.TextSize = 14
espButton.Parent = mainFrame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 8)
btnCorner.Parent = espButton

-- 2. FUNCIÓN PARA MOVER EL HUB (PC & Móvil)
local dragging, dragInput, dragStart, startPos

mainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = mainFrame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = input.Position - dragStart
		mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)

-- 3. LÓGICA DEL ESP KILLER
local espEnabled = false

local function updateESP()
	-- Limpiar resaltados viejos
	for _, p in pairs(Players:GetPlayers()) do
		if p.Character then
			local old = p.Character:FindFirstChild("KillerHighlight")
			if old then old:Destroy() end
		end
	end

	if not espEnabled then return end

	-- Buscar al equipo Killer
	local killerTeam = Teams:FindFirstChild("Killer")
	if killerTeam then
		for _, p in pairs(Players:GetPlayers()) do
			if p.Team == killerTeam and p.Character and p ~= player then
				local char = p.Character
				local highlight = Instance.new("Highlight")
				highlight.Name = "KillerHighlight"
				highlight.FillColor = Color3.new(1, 0, 0) -- Rojo
				highlight.FillTransparency = 0.5
				highlight.OutlineColor = Color3.new(1, 1, 1)
				highlight.Parent = char
			end
		end
	end
end

espButton.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	if espEnabled then
		espButton.BackgroundColor3 = Color3.fromRGB(80, 255, 80) -- Verde
		espButton.Text = "ESP: ON"
	else
		espButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80) -- Rojo
		espButton.Text = "Esp Killer"
	end
	updateESP()
end)

-- Bucle para actualizar si el Killer muere o cambia de equipo
RunService.RenderStepped:Connect(function()
	if espEnabled then
		updateESP()
	end
end)
